---
title: "Data Interpretation Session"
subtitle: "Based on Key Research Questions"
author: "Your name"
date: "`r format(Sys.Date(),  '%d %B %Y')`"
output:
  unhcrdown::pptx_slides
params:
  datafolder: "data-raw"
  data: "data.xlsx"
  form: "form.xlsx"
  datasource: "Study name reference" ## String used in caption for all your charts
  ridl: "ridlproject" ## Name of the ridl project where you data is documented and archived
  publish: "no" ## put to "yes" in order to add your report, source and analysis plan as ressource within the same ridl dataset
  visibility: "public"
  stage: "interpretation_prez"
  
---
<!--
Please use this template only once you have completed the data exploration steps and configured all the steps for the initial data analysis plan 
-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE,
                      collapse = FALSE,
                      comment = "#>",
                      # fig.width = 5.5, fig.height = 4,
                      fig.retina = 2, 
                      fig.width = 9,
                      fig.asp = 0.618,
                      fig.align = "center",
                      dev = "ragg_png",
                      out.width = "90%")
options(scipen = 999) # turn-off scientific notation like 1e+48
set.seed(1)
extrafont::loadfonts(quiet=TRUE)

library("tidyverse")
library("officedown")
library("unhcrthemes")
library("ggplot2")
library("rvg")
library("tidyverse")
library("scales")
library("lubridate")


##  make sure to get last version 
if ( packageVersion("kobocruncher") != "0.2.5"){pak::pkg_install("edouard-legoupil/kobocruncher")}
library("kobocruncher")
# turn off the automatic use of showtext functionality, so that the dml function can works properly
showtext::showtext_auto(FALSE) 
```

```{r  }
## The 2 lines below are for the demo - please comment the 2 below 
# and uncomment the one after once you have set up your report parameters..
datapath <- system.file("data.xlsx", package = "kobocruncher")
xlsformpath <-  system.file("sample_xlsform.xlsx", package = "kobocruncher")
# datapath <- here::here(params$datafolder, params$data)
# xlsformpath <- here::here(params$datafolder, params$form) 

datalist <- kobo_data(datapath = datapath )
dico <- kobo_dico(xlsformpath = xlsformpath)
questions <- as.data.frame(dico[1])
```

## Joint Data Interpretation  

The Joint Data Interpretation allows to make sense of the data.

The interpretation can make use of the "__Protection Risk Equation__" Analysis (See [Protection Gap Framework for Analysis](https://www.unhcr.org/50aa57ad9.pdf)) to look at 1) Harmful, discriminatory and/or protective contextual factors, 2) Current threats to the population, 3) Rights violations and abuses, 4) Threat effect on the population and 5) Existing capacities to address protection threats .

 
---

# Demo of different charts


<!--
Note that in this template it is key to use 
-> p
dml(ggobj = p, fonts = list(serif = 'Lato'))

The function dml will convert your ggplot object into an editable vector for powerpoint

-->

---

## Slide with `plot_select_one`

```{r layout='Title and Content', ph=officer::ph_location_type(type="body")}
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )-> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

## Slide with `plot_select_multiple`

```{r layout='Title and Content', ph=officer::ph_location_type(type="body")}
## here you can paste selected charts from the initial exploration phase...
plot_select_multiple(datalist = datalist,
              dico = dico, 
              var = "profile.reason",
                datasource = params$datasource) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

## Slide with `plot_integer`

```{r layout='Title and Content', ph=officer::ph_location_type(type="body")}
## here you can paste selected charts from the initial exploration phase...
plot_integer(datalist = datalist, 
              dico = dico, 
              "members.age",
              datasource = params$datasource) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

## Slide with `plot_text`

```{r layout='Title and Content', ph=officer::ph_location_type(type="body")}
## here you can paste selected charts from the initial exploration phase...
plot_text(datalist = datalist,
              dico = dico, 
              var = "profile.occupation",
              datasource = params$datasource) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```



---
 

## Columns & Images

:::::: {.columns}
::: {.column}
Content of the left column.

*  list 1
*  list 2
:::

::: {.column}
Content of the right column.

1.  list 1
2.  list 2
:::
::::::






```{r}
## Time to archive your work once done!! 
if( params$publish == "yes"){
  namethisfile = basename(rstudioapi::getSourceEditorContext()$path ) 
  kobo_ridl(ridl = params$ridl,
            datafolder = params$datafolder,
            form = params$form,
            namethisfile =  namethisfile ,
            visibility =  params$visibility,
            stage = params$stage) }
```

