---
title: "Tecnical Report "
subtitle: "Survey Documentation"
author: "Your name"
date: "`r format(Sys.Date(),  '%d %B %Y')`"
output:
  unhcrdown::docx_simple:
    toc: yes
    toc_depth: 2
    number_sections: yes
params: 
  year: 2022
  country: "ARG"
  datafolder: "data-raw"
  data: "data.xlsx"
  form: "form.xlsx"
  datasource: "Study name reference" ## String used in caption for all your charts
  ridl: "ridlproject" ## Name of the ridl project where you data is documented and archived
  publish: "no" ## put to "yes" in order to add your report, source and analysis plan as ressource within the same ridl dataset
  visibility: "public"
  stage: "technical_report"
  
---

<!--
Please use this template only once you have completed the data exploration steps and configured all the steps for the initial data analysis plan 
-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE,
                      collapse = FALSE,
                      comment = "#>",
                      # fig.width = 5.5, fig.height = 4,
                      fig.retina = 2, 
                      fig.width = 6.27,
                      fig.align = "center",
                      dev = "ragg_png",
                      out.width = "90%")
options(scipen = 999) # turn-off scientific notation like 1e+48
set.seed(1)
extrafont::loadfonts(quiet=TRUE)

library("tidyverse")
library("officedown")
library("officer")
library("unhcrthemes")
library("ggplot2")
library("rvg")
library("tidyverse")
library("scales")
library("lubridate")

##  make sure to get last version 
if ( packageVersion("kobocruncher") != "0.2.6"){pak::pkg_install("edouard-legoupil/kobocruncher")}
library("kobocruncher")
# turn off the automatic use of showtext functionality, so that the dml function can works properly
showtext::showtext_auto(FALSE) 
```



```{r getdata, include=FALSE}
### pull ridl metadata
p <- riddle::dataset_show(params$ridl)
list_of_resources <- p[["resources"]][[1]]

```

Report based on `r p[["short_title" ]]`

Note that most part of this reports pull metadata from [RIDL](`r paste0("https://ridl.unhcr.org/dataset/",params$ridl ) `).

If information is missing please, document in RIDL and regenerate the report.

#	I  Abstract

`r as.character(p[["notes"]])`

#	II - Introduction

##	a. Overview of RMS 

###	PoCs surveyed

Data Operational purpose is `r p[["operational_purpose_of_data"]]`

###	Geographic coverage

The covered area is `r p[["geographies"]]` and coverage is `r p[["geog_coverage"]]`


##	Background on population data 

```{r examples-plot_ctr_population_type_per_year, fig.retina = 1, fig.width = 12, fig.asp = 0.618, fig.align = "left", dev = "ragg_png", out.width = "110%"}
unhcrdatapackage::plot_ctr_population_type_per_year(year = 2022,
                                  lag = 5,
                         country_asylum_iso3c = params$country,
                          pop_type = c("REF",
                                       "ASY",
                                       "OIP",
                                       "OOC",
                                       "STA",
                                       "IDP" ))
```


#	III - Methodology and Limitations

## a- 	Methods

###	Survey design

Unit of measurement for the study is `r p[["unit_of_measurement" ]]`.

###	Sample design

`r p[["admin_notes"]]`

####	Sampling procedures 

The sampling procedure was based on `r p[["sampling_procedure"]]`. `r p[["sampling_procedure_notes" ]]`

####	Response rate

`r p[["response_rate_notes"]]` 

####	Weighting 

`r p[["weight_notes"]]`


###	Questionnaire topics and indicators
```{r}
cat(paste0(as.character(p[["keywords"]])))
```


###	Ethical approval

Data identifiability level is `r p[[ "identifiability"]]` and access to data is governed by the following: `r p[[ "data_accs_notes" ]]`


###	Field procedures

####	Data collection period


Data Collection started on `r p[["date_range_start" ]]` and ended on `r p[["date_range_end"  ]]`

####	Data collection model 

`r p[["data_collection_technique"]]`


####	Field team management structure 

`r p[["data_collection_notes" ]]`

####	Data quality checks 

###	Data processing and analysis

####	Data cleaning


`r p[["clean_ops_notes"]]`

####	Draft indicator calculations 


## b-	Data limitations and fieldwork challenges



# IV -	Findings 

```{r  }
## The 2 lines below are for the demo - please comment the 2 below 
# and uncomment the one after once you have set up your report parameters..
datapath <- system.file("data.xlsx", package = "kobocruncher")
xlsformpath <-  system.file("sample_xlsform.xlsx", package = "kobocruncher")
# datapath <- here::here(params$datafolder, params$data)
# xlsformpath <- here::here(params$datafolder, params$form) 

datalist <- kobo_data(datapath = datapath )
dico <- kobo_dico(xlsformpath = xlsformpath)
questions <- as.data.frame(dico[1])
```


<!--
Note that in this template it is key to use 
 +
  unhcrthemes::theme_unhcr(font_size = 12)

This will adjust the size of the font within your charts

-->


##	a- Characteristics of the survey PoC populations

##	b-	Indicator Findings 

###		Mobility and registration

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```


###		Disability

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```

###		Energy sources, WASH, and Dwelling

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```

###		Social protection, health access, and education

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```

###		Banking, unemployment, and income

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```

###		Safety and GBV

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```

###		Education, health access and vaccination

```{r }
## here you can paste selected charts from the initial exploration phase...
plot_select_one(datalist = datalist,
                dico = dico, 
                "location",
                datasource = params$datasource  )  +
  unhcrthemes::theme_unhcr(font_size = 12)
```


## c-	Any additional analysis 

Has the partner has carried out as per your contract / PPA ToR?

#	V - Conclusions and Recommendations

#	References 

# Annexes

 
 
 

```{r}
## Time to archive your work once done!! 
if( params$publish == "yes"){
  namethisfile = basename(rstudioapi::getSourceEditorContext()$path ) 
  kobo_ridl(ridl = params$ridl,
            datafolder = params$datafolder,
            form = params$form,
            namethisfile =  namethisfile ,
            visibility =  params$visibility,
            stage = params$stage) }
```

